<polymer-element name="socket-io" attributes="devices players socket">

  <script>

    Polymer('socket-io', {

      //  Set observers
      observe : {
        'socket' : 'socketReady'
      },

      socketReady : function () {

        //  Method to add a new player on stage
        var addPlayer = (function (data) {
          var newPlayer = new gamePlayer();
          newPlayer.setAttribute('uid', data.uid);
          newPlayer.setAttribute('devices', '{{ devices }}');
          this.parentNode.appendChild(newPlayer);
          console.info('Player connect:', data.uid);
        }.bind(this));

        //  Method to remove a player from stage
        var removePlayer = (function (data) {
          var selector = '[uid=' + data.uid + ']';
          var player = this.parentNode.querySelector(selector);
          this.parentNode.removeChild(player);
          console.info('Player disconnect:', data.uid);
        }.bind(this));

        //  First, tell the server that client is now ready
        this.socket.emit('client ready');

        this.socket.on('new player connection', function (data) {
          //  Store players
          this.players = data.players;
          //  Add new user on stage
          addPlayer(data);
        }.bind(this));

        this.socket.on('player first connection', function (data) {
          //  Update players
          this.players = data.players;
          //  Add players on stage
          for (var property in this.player) {
            //  But not the player itself
            if (property !== data.uid) {
              addPlayer(data);
            }
          }
        }.bind(this));

        this.socket.on('player left', function (data) {
          //  Update players
          this.players = data.players;
          //  Remove player from stage
          removePlayer(data);
        }.bind(this));

      }

    });

  </script>

</polymer-element>
