<polymer-element name="socket-io" attributes="devices players socket">

  <script>

    Polymer('socket-io', {

      //  Set observers
      observe : {
        'socket' : 'socketReady'
      },

      socketReady : function () {

        var stage = document.querySelector('game-stage');
        console.log(stage);

        //  First, tell the server that client is now ready
        this.socket.emit('client ready');

        this.socket.on('new player connection', function (data) {
          //  Store players
          this.players = data.players;
          console.log('new player here:' + data.uid);
          console.log(this.players);
          //  Add new user on stage
          var player = new gamePlayer();
          document.body.appendChild(player);
        }.bind(this));

        this.socket.on('player first connection', function (data) {
          var newPlayer;
          //  Update players
          this.players = data.players;
          //  Add players on stage
          for (var property in this.player) {
            //  But not the player itself
            if (property !== data.uid) {
              newPlayer = new gamePlayer();
              newPlayer.setAttribute('devices', this.devices);
              stage.appendChild(newPlayer);
            }
          }
          console.log('FIRST');
          console.log(Object.keys(data.players));
          console.log(data.uid);
        }.bind(this));

        this.socket.on('player left', function (data) {
          //  Update players
          this.players = data.players;
          console.log(data.players);
          console.log(data.uid);
        }.bind(this));

      }

    });

  </script>

</polymer-element>
