<polymer-element name="socket-io" attributes="devices players socket">

  <script>

    Polymer('socket-io', {

      //  Set observers
      observe : {
        'socket' : 'socketReady'
      },

      socketReady : function () {

        //  Method to add a new player on stage
        var addPlayer = (function (data) {
          var newPlayer = new gamePlayer();
          newPlayer.setAttribute('id', data.uid);
          newPlayer.setAttribute('devices', '{{ devices }}');
          this.parentNode.appendChild(newPlayer);
        }.bind(this));

        //  First, tell the server that client is now ready
        this.socket.emit('client ready');

        this.socket.on('new player connection', function (data) {
          //  Store players
          this.players = data.players;
          console.log('new player here:' + data.uid);
          console.log(this.players);
          //  Add new user on stage
          addPlayer(data);
        }.bind(this));

        this.socket.on('player first connection', function (data) {
          //  Update players
          this.players = data.players;
          //  Add players on stage
          for (var property in this.player) {
            //  But not the player itself
            if (property !== data.uid) {
              addPlayer(data);
            }
          }
          console.log('FIRST');
          console.log(Object.keys(data.players));
          console.log(data.uid);
        }.bind(this));

        this.socket.on('player left', function (data) {
          //  Update players
          this.players = data.players;
          console.log(data.players);
          console.log(data.uid);
        }.bind(this));

      }

    });

  </script>

</polymer-element>
