<polymer-element name="animate-player" attributes="animationLock path devices">

  <template>

    <core-animation duration="{{ path.length * 500 }}" id="animation">

      <template repeat="{{ step, i in path }}">

        <core-animation-keyframe offset="{{ (1 / (path.length - 1)) * i }}">

          <template if="{{ devices.mobile }}">
            <core-animation-prop name="transform" value="{{ step | toTranslate(60) }}">
            </core-animation-prop>
          </template>

          <template if="{{ devices.medium }}">
            <core-animation-prop name="transform" value="{{ step | toTranslate(75) }}">
            </core-animation-prop>
          </template>

          <template if="{{ devices.large }}">
            <core-animation-prop name="transform" value="{{ step | toTranslate(90) }}">
            </core-animation-prop>
          </template>

          <template if="{{ devices.xlarge }}">
            <core-animation-prop name="transform" value="{{ step | toTranslate(105) }}">
            </core-animation-prop>
          </template>

          <template if="{{ devices.xxlarge }}">
            <core-animation-prop name="transform" value="{{ step | toTranslate(120) }}">
            </core-animation-prop>
          </template>

        </core-animation-keyframe>

      </template>

    </core-animation>

  </template>

   <script>

      Polymer('animate-player', {

        ready : function () {
          //  Add a listener for animation end
          this.addEventListener('core-animation-finish', function(event) {
            this.animationLock = false;
          }.bind(this));
        },

        pathChanged : function () {
          if (this.animationLock === false) {
            this.async(this.play);
          }
        },

        play : function () {
          //  Lock animation
          this.animationLock = true;
          //  Launch animation
          this.$.animation.play();
        },

        toTranslate : function (value, pixels) {
          var result = 'translate(';
          result += (value[0] * pixels);
          result += 'px, ';
          result += (value[1] * pixels);
          result += ')';
          return result;
        }
        
      });

    </script>

</polymer-element>
